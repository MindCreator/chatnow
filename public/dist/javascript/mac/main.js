require.config({shim:{socketio:{exports:"io"}},baseUrl:"/",paths:{jquery:"lib/jquery/jquery-1.11.0.min",jqueryui:"lib/jquery-ui/js/jquery-ui-1.10.4.custom.min",socketio:"lib/socket-io/socket.io",template:"lib/template/template",cookie:"lib/jquery-plugin/jquery.cookie",director:"javascript/mac/director",util:"javascript/util"}}),require(["jquery","socketio","director","template"],function(e,t,n,r){var i={id:"",nickname:"",face:"",desc:""};r.openTag="{{",r.closeTag="}}";var s=t.connect(window.location.host),o=[],u={};(function(){var e=require("director");s.on("join",function(t){if(!t.isSuccess)return;i.id=t.id,console.log("房间号"+t.roomId),u[t.roomId]={},o.push(t.roomId);var n;for(var r in t.members)if(t.members[r].id!=i.id){n=t.members[r];break}e.joined(t.roomId,n)}),s.on("leave",function(t){console.log("房间号"+t.roomId);var n=o.indexOf(t.roomId);o.splice(n),e.left(t.roomId)}),s.on("msg",function(t){console.log("房间号"+t.roomId),console.log("内容是"+t.content),console.log("时间是"+t.time),console.log("发送者"+t.sender),e.receive(t.roomId,t.sender,t.content)}),s.on("notice",function(t){console.log("房间号"+t.roomId),console.log("内容是"+t.content),console.log("时间是"+t.time),e.notice({roomId:t.roomId})}),s.on("profile",function(t){console.log("id是"+t.id),console.log("nickname是"+t.nickname),console.log("face是"+t.face),console.log("desc是"+t.desc),e.profiled(t.id,t.nickname,t.face,t.desc)})})();var a={join:function(){s.emit("join"),n.join()},leave:function(t){s.emit("leave",{roomId:t}),n.leave(t)},send:function(t,r){(!t||!r)&&n.alert({content:"刷新页面重试"});if(r.trim()=="")return;s.emit("msg",{roomId:t,content:r}),n.send(t,r)},profile:function(t,r,i){s.emit("profile",{nickname:t,face:r,desc:i}),n.profile()}};(function(){var t="admin",i="抹茶姑娘",s="http://tp1.sinaimg.cn/2862820140/50/5691239858/0",o="欢迎来到抹茶，希望我能给你一段欢乐时间",u=r.render("user-tab-tpl",{roomId:t,nickname:i,face:s,desc:"欢迎来到抹茶，希望我能给你一段欢乐时间",userClass:"active"}),a=e(u);a.attr("id","tab-"+t),e(".user-list").append(a),u=r.render("panel-tpl",{nickname:i,face:s,desc:o,roomId:t}),a=e(u),a.attr("id","panel-"+t),e(".right-panel").append(a),a.show(),n.receive(t,{nickname:"抹茶姑娘"},"很高兴能见到你来抹茶跟大家聊天！")})(),e("#join").click(function(){a.join()}),e(".right-panel").delegate(".po textarea","keydown",function(t){if(t.keyCode==13&&t.ctrlKey==0){var n=e(t.currentTarget).parent().parent().attr("room-id"),r=e(t.currentTarget).val();a.send(n,r),t.preventDefault()}return}),e(".user-list").delegate(".tab","click",function(t){var n=e(t.currentTarget).attr("room-id");if(!n)return;e(".tab.active").removeClass("active"),e(".panel").hide(),e("#tab-"+n).addClass("active"),e("#panel-"+n).show(),e("#chat-"+n).scrollTop(e("#chat-"+n)[0].scrollHeight-365);var r=e("#tab-"+n).find(".addition");r.removeClass("unread"),r.html("")}),e("#i-profile").click(function(){e("#profile-setting").hidden()&&(e(".tab.active").removeClass("active"),e(".panel").hide(),e("#tab-admin").addClass("active"),e("#profile-setting").show())}),e("#panel-admin").delegate(".po textarea","keydown",function(t){if(t.keyCode==13&&t.ctrlKey==0){var r=e(t.currentTarget).val();if(!r||r.trim()=="")return;var i,s,o,u=/@[\u4e00-\u9fa5\w]{2,10}/,f=/#[\u4e00-\u9fa5\w]{2,}/,l=/!(http|ftp|https):\/\/[\w\-_]+(\.[\w\-_]+)+([\w\-\.,@?^=%&amp;:/~\+#]*[\w\-\@?^=%&amp;/~\+#])?\.(jpg|gif|png)/;u.test(r)&&(i=u.exec(r)[0].substr(1)),f.test(r)&&(s=f.exec(r)[0].substr(1)),l.test(r)&&(o=l.exec(r)[0].substr(1)),a.profile(i,o,s);var c={nickname:i,face:o,desc:s};for(var h in c){if(!c[h])continue;var p="啊，好的嘛！你的";switch(h){case"nickname":p+="昵称将改为";break;case"face":p+="头像地址将改为";break;case"desc":p+="个人介绍将改为"}n.receive("admin",{nickname:"抹茶姑娘"},p+c[h])}t.preventDefault()}return}),e(".right-panel").delegate(".leave","click",function(t){var n=e(t.currentTarget).attr("room-id");a.leave(n)})});